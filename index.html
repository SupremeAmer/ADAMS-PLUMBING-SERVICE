<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Adams Plumbing Service</title>
  <meta name="description" content="Adams Plumbing Service: Trusted, Fast, Professional Plumbers. 24/7 Service!" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #3a86ff;
      --primary-light: #00b4d8;
      --accent: #ffbe0b;
      --dark: #22223b;
      --gray-bg: #f5f7fa;
      --radius: 18px;
    }
    body {
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      background: var(--gray-bg);
      color: var(--dark);
      scroll-behavior: smooth;
    }
    .container {
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 1.2rem;
    }
    .header {
      background: var(--dark);
      color: #fff;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 1px 6px rgba(0,0,0,0.07);
    }
    .header__container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: .8rem 0;
    }
    .logo {
      font-weight: 700;
      font-size: 1.35rem;
      letter-spacing: 1px;
    }
    .nav a {
      color: #fff;
      text-decoration: none;
      margin-left: 1.7rem;
      font-weight: 500;
      transition: color .2s;
    }
    .nav a:hover {
      color: var(--accent);
    }
    .hero {
      background: linear-gradient(120deg, var(--primary), var(--primary-light) 80%);
      color: #fff;
      padding: 4.5rem 0 3.5rem 0;
      border-radius: 0 0 2.2rem 2.2rem;
      box-shadow: 0 8px 32px rgba(60,60,60,.07);
    }
    .hero__container {
      text-align: center;
    }
    .hero__title {
      font-size: 2.6rem;
      margin-bottom: .7rem;
      font-weight: 700;
      letter-spacing: 1px;
      animation: fadeInDown .9s cubic-bezier(.55,.06,.68,.19);
    }
    .hero__subtitle {
      font-size: 1.22rem;
      margin-bottom: 1.7rem;
      animation: fadeInDown 1.3s .2s cubic-bezier(.55,.06,.68,.19) backwards;
    }
    .hero__cta {
      animation: fadeInUp 1.1s .5s cubic-bezier(.55,.06,.68,.19) backwards;
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-40px);}
      to { opacity: 1; transform: translateY(0);}
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .section-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 2rem;
      text-align: center;
      color: var(--primary);
      letter-spacing: .5px;
    }
    .services {
      margin: 3.5rem 0 0 0;
    }
    .services__grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 2rem;
      padding-bottom: 2rem;
    }
    .service-card {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: 0 3px 18px rgba(60,60,60,.07);
      padding: 2.2rem 1.3rem 1.3rem 1.3rem;
      text-align: center;
      transition: box-shadow .2s, transform .2s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp .9s forwards;
      will-change: opacity, transform;
    }
    .service-card__icon {
      font-size: 2.1rem;
      background: var(--accent);
      color: var(--primary);
      width: 54px;
      height: 54px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.1rem auto;
      border-radius: 50%;
      transition: background .22s, color .22s, transform .22s;
      box-shadow: 0 2px 9px rgba(255,190,11,.11);
    }
    .service-card:hover {
      box-shadow: 0 9px 30px rgba(60,60,60,.12);
      transform: translateY(-6px) scale(1.025);
    }
    .service-card:hover .service-card__icon {
      background: var(--primary);
      color: #fff;
      transform: scale(1.12) rotate(-6deg);
    }
    .service-card h3 {
      margin: 0 0 .5rem 0;
      font-size: 1.14rem;
      font-weight: 700;
    }
    .service-card p {
      color: #333;
      font-size: .97rem;
      margin: 0;
    }
    .service-card:nth-child(1) { animation-delay: 0s;}
    .service-card:nth-child(2) { animation-delay: .1s;}
    .service-card:nth-child(3) { animation-delay: .2s;}
    .service-card:nth-child(4) { animation-delay: .3s;}
    .service-card:nth-child(5) { animation-delay: .4s;}
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: none;
      }
    }
    .about {
      margin: 2rem 0 0 0;
    }
    .about__container {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: 0 3px 16px rgba(60,60,60,.07);
      padding: 2.6rem 1.7rem;
      max-width: 700px;
      margin: 0 auto;
      font-size: 1.06rem;
      color: #444;
      opacity: 0;
      transform: translateY(36px);
      animation: fadeInUp .9s .2s forwards;
      will-change: opacity, transform;
    }
    .about__container ul {
      margin-top: 1.1rem;
      padding-left: 1.4rem;
      list-style: none;
    }
    .about__container li {
      margin-bottom: .55rem;
      position: relative;
      padding-left: 1.3em;
    }
    .about__container li::before {
      content: '';
      position: absolute;
      left: 0;
      top: .5em;
      width: .7em;
      height: .7em;
      background: var(--accent);
      border-radius: 50%;
      display: inline-block;
      margin-right: .3em;
    }
    .contact {
      margin: 2.5rem 0 0 0;
    }
    .contact__container {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: 0 2px 13px rgba(60,60,60,.10);
      max-width: 540px;
      margin: 0 auto;
      padding: 2.5rem 1.4rem 2.3rem 1.4rem;
      opacity: 0;
      transform: translateY(36px);
      animation: fadeInUp .9s .2s forwards;
      will-change: opacity, transform;
    }
    .contact-form {
      display: flex;
      flex-direction: column;
      gap: 1.1rem;
    }
    .contact-form input,
    .contact-form textarea {
      font-size: 1rem;
      padding: .9rem .8rem;
      border-radius: 7px;
      border: 1px solid #c9c9c9;
      outline: none;
      transition: border .18s;
    }
    .contact-form input:focus,
    .contact-form textarea:focus {
      border: 1.5px solid var(--primary);
    }
    .contact-form textarea {
      resize: vertical;
      min-height: 86px;
    }
    .form-success {
      background: #d4edda;
      color: #155724;
      border-radius: 7px;
      padding: .95em 1em;
      text-align: center;
      display: none;
      font-size: 1rem;
      margin-top: .7em;
      animation: fadeInDown .6s cubic-bezier(.55,.06,.68,.19);
    }
    .btn {
      display: inline-block;
      padding: .88em 2.1em;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.09rem;
      text-decoration: none;
      background: var(--accent);
      color: var(--dark);
      border: none;
      cursor: pointer;
      transition: background .2s, transform .2s, box-shadow .2s, color .2s;
      box-shadow: 0 2px 13px rgba(255,190,11,.08);
    }
    .btn:hover, .btn:focus {
      background: #ffe585;
      transform: translateY(-2px) scale(1.045);
      box-shadow: 0 6px 26px rgba(255,190,11,.14);
      color: var(--primary);
    }
    .btn--primary {
      background: var(--accent);
      color: var(--dark);
    }
    .footer {
      margin-top: 2.8rem;
      background: var(--dark);
      color: #fff;
      padding: 1.7rem 0 1rem 0;
      text-align: center;
      font-size: 1rem;
      border-radius: 2.2rem 2.2rem 0 0;
    }
    /* =================== ADMIN PANEL STYLES =================== */
    .admin-panel-link {
      display: inline-block;
      margin-left: 1.7rem;
      font-weight: 500;
      color: var(--accent);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      transition: color .2s;
      text-decoration: underline;
      padding: 0;
    }
    .admin-panel-link:hover {
      color: var(--primary-light);
    }
    .admin-panel-modal-bg {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(34,34,59,0.45);
      justify-content: center;
      align-items: start;
      overflow-y: auto;
    }
    .admin-panel-modal-bg.active {
      display: flex;
    }
    .admin-panel-modal {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: 0 8px 36px rgba(60,60,60,.15);
      max-width: 720px;
      min-width: 280px;
      width: 98vw;
      margin: 2.5rem auto;
      padding: 2rem 1.5rem 3rem 1.5rem;
      position: relative;
      animation: fadeInUp .5s;
    }
    .admin-panel-close {
      position: absolute;
      right: 1.2rem;
      top: 1.2rem;
      background: none;
      border: none;
      font-size: 2rem;
      color: #bbb;
      cursor: pointer;
      transition: color .18s;
    }
    .admin-panel-close:hover { color: #d90429;}
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2.2rem;
    }
    .admin-title {
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: .5px;
    }
    .logout-btn {
      background: var(--accent);
      color: var(--dark);
      border: none;
      font-weight: 600;
      border-radius: 7px;
      padding: .6em 1.2em;
      cursor: pointer;
      transition: background .18s;
    }
    .logout-btn:hover { background: #ffe585;}
    .login-section {
      max-width: 340px;
      margin: 4rem auto 0 auto;
      background: #fff;
      border-radius: var(--radius);
      box-shadow: 0 2px 18px rgba(60,60,60,.11);
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      animation: fadeInDown .7s;
    }
    .login-section input {
      padding: .9em .8em;
      border-radius: 7px;
      border: 1px solid #c9c9c9;
      outline: none;
      font-size: 1rem;
    }
    .login-section button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: .7em 1.5em;
      font-weight: 700;
      cursor: pointer;
      transition: background .22s;
    }
    .login-section button:hover { background: var(--primary-light);}
    .error-msg {
      color: #d90429;
      font-size: 1rem;
      background: #ffd5d5;
      padding: .8em 1em;
      border-radius: 7px;
      margin-bottom: .8em;
      display: none;
    }
    .success-msg {
      color: #017501;
      font-size: 1rem;
      background: #cdf7cd;
      padding: .8em 1em;
      border-radius: 7px;
      margin-bottom: .8em;
      display: none;
    }
    .post-form {
      background: #f6faff;
      border-radius: var(--radius);
      padding: 1.4rem 1rem;
      margin-bottom: 2.5rem;
      box-shadow: 0 2px 10px rgba(60,60,60,.03);
      animation: fadeInUp .7s;
    }
    .post-form input[type="file"] {
      margin-bottom: .7rem;
    }
    .post-form textarea {
      width: 100%;
      min-height: 64px;
      border-radius: 7px;
      border: 1px solid #c9c9c9;
      padding: .8em;
      font-size: 1rem;
      margin-bottom: .7rem;
      resize: vertical;
    }
    .post-form button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: .6em 1.7em;
      font-weight: 700;
      cursor: pointer;
      transition: background .18s;
    }
    .post-form button:hover { background: var(--primary-light);}
    .posts-list {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.6rem;
    }
    .post-card {
      background: #f9f9ff;
      border-radius: var(--radius);
      box-shadow: 0 2px 13px rgba(60,60,60,.07);
      padding: 1.4rem 1.1rem;
      position: relative;
      animation: fadeInUp .7s;
    }
    .post-media {
      display: block;
      margin: 0 auto 1rem auto;
      max-width: 100%;
      border-radius: 11px;
      max-height: 260px;
      object-fit: contain;
      background: #eee;
    }
    .post-desc {
      margin-bottom: .6rem;
      font-size: 1.03rem;
    }
    .post-actions {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 1rem;
    }
    .like-btn, .comment-btn {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1.1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: .3em;
      transition: color .1s;
    }
    .like-btn.liked { color: #d90429;}
    .like-btn:hover, .comment-btn:hover { color: var(--accent);}
    .comments-section {
      margin-top: .4rem;
      background: #eafcff;
      border-radius: 9px;
      padding: .8rem .8rem .3rem .8rem;
    }
    .comment {
      display: flex;
      align-items: flex-start;
      gap: .7em;
      margin-bottom: .7em;
    }
    .comment-user {
      font-weight: 700;
      color: var(--primary);
    }
    .comment-content {
      background: #fff;
      border-radius: 7px;
      padding: .5em .9em;
      font-size: .97rem;
      box-shadow: 0 1px 5px rgba(60,60,60,.06);
    }
    .add-comment-form {
      display: flex;
      gap: .6em;
      margin-top: .7em;
      align-items: center;
    }
    .add-comment-form input {
      flex: 1;
      padding: .5em;
      border-radius: 6px;
      border: 1px solid #c9c9c9;
    }
    .add-comment-form button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: .5em 1.1em;
      cursor: pointer;
      font-weight: 600;
    }
    @media (max-width: 700px) {
      .admin-panel-modal { padding: 1.2rem .2rem 2.2rem .2rem; }
      .admin-title { font-size: 1.15rem; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container header__container">
      <div class="logo">🚰 Adams Plumbing Service</div>
      <nav class="nav">
        <a href="#services">Services</a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
        <button class="admin-panel-link" id="openAdminPanelBtn">Admin</button>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container hero__container">
      <h1 class="hero__title">Professional Plumbing Services</h1>
      <p class="hero__subtitle">Trusted. Fast. Professional.<br>24/7 Emergency Service</p>
      <a href="#contact" class="btn btn--primary hero__cta">Book Now</a>
    </div>
  </section>

  <section class="services" id="services">
    <div class="container">
      <h2 class="section-title">Our Services</h2>
      <div class="services__grid">
        <div class="service-card">
          <div class="service-card__icon">🔧</div>
          <h3>General Plumbing</h3>
          <p>Leaks, repairs, and installations. No job is too small or big.</p>
        </div>
        <div class="service-card">
          <div class="service-card__icon">🚽</div>
          <h3>Toilet & Sewer</h3>
          <p>Toilet repairs, sewer line cleaning, and clog removal.</p>
        </div>
        <div class="service-card">
          <div class="service-card__icon">🛁</div>
          <h3>Bathroom Plumbing</h3>
          <p>Shower, faucet, sink, and tub solutions.</p>
        </div>
        <div class="service-card">
          <div class="service-card__icon">💧</div>
          <h3>Water Heaters</h3>
          <p>Installation and repair of tank and tankless water heaters.</p>
        </div>
        <div class="service-card">
          <div class="service-card__icon">⏰</div>
          <h3>Emergency Service</h3>
          <p>24/7 emergency plumbing help, whenever you need us.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="about" id="about">
    <div class="container about__container">
      <h2 class="section-title">About Us</h2>
      <p>
        <b>Adams Plumbing Service</b> is family-owned and operated, providing top-quality plumbing solutions for over a decade. Our licensed, insured team brings professionalism, transparency, and a customer-first approach to every job.
      </p>
      <ul>
        <li>✅ Fast response & 24/7 availability</li>
        <li>✅ Transparent pricing</li>
        <li>✅ 100% satisfaction guaranteed</li>
        <li>✅ Friendly local experts</li>
      </ul>
    </div>
  </section>

  <section class="contact" id="contact">
    <div class="container contact__container">
      <h2 class="section-title">Contact Us</h2>
      <form id="contactForm" class="contact-form" autocomplete="off">
        <input type="text" name="name" placeholder="Full Name" required />
        <input type="email" name="email" placeholder="Email Address" required />
        <input type="tel" name="phone" placeholder="Phone Number" required />
        <textarea name="message" placeholder="How can we help you?" required></textarea>
        <button type="submit" class="btn btn--primary">Send Message</button>
        <div class="form-success" id="formSuccess">Thank you! We'll get back to you soon.</div>
      </form>
    </div>
  </section>

  <footer class="footer">
    <div class="container footer__container">
      &copy; <span id="year"></span> Adams Plumbing Service. All rights reserved.
    </div>
  </footer>

  <!-- ========== ADMIN PANEL MODAL ========== -->
  <div class="admin-panel-modal-bg" id="adminPanelModal">
    <div class="admin-panel-modal" id="adminPanelModalBox">
      <button class="admin-panel-close" id="closeAdminPanelBtn" title="Close">&times;</button>
      <!-- Login UI -->
      <div class="login-section" id="loginSection" style="display:none;">
        <div style="text-align:center;font-weight:700;color:var(--primary);font-size:1.3rem;margin-bottom:1rem;">Admin Login</div>
        <div class="error-msg" id="loginError"></div>
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button id="loginBtn">Login</button>
      </div>
      <!-- Admin Panel UI -->
      <div id="adminPanel" style="display:none;">
        <div class="admin-header">
          <div class="admin-title">Admin Panel - Adams Plumbing Service</div>
          <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>
        <div class="success-msg" id="postSuccess"></div>
        <form class="post-form" id="postForm" autocomplete="off">
          <div style="margin-bottom:.5em;font-weight:600;">Create New Post</div>
          <input type="file" id="mediaInput" accept="image/*,video/*" required>
          <textarea id="descInput" placeholder="Enter description..." maxlength="300" required></textarea>
          <button type="submit">Post</button>
        </form>
        <div class="posts-list" id="postsList"></div>
      </div>
    </div>
  </div>
  <!-- ========== END ADMIN PANEL MODAL ========== -->

  <!-- Appwrite SDK -->
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
  <script>
    // Animate on scroll (for cards and sections)
    function animateOnScroll() {
      const serviceCards = document.querySelectorAll('.service-card');
      const about = document.querySelector('.about__container');
      const contact = document.querySelector('.contact__container');
      const triggerBottom = window.innerHeight * 0.92;

      serviceCards.forEach(el => {
        const boxTop = el.getBoundingClientRect().top;
        if (boxTop < triggerBottom) {
          el.style.animationPlayState = 'running';
        }
      });
      [about, contact].forEach(el => {
        if (!el) return;
        const boxTop = el.getBoundingClientRect().top;
        if (boxTop < triggerBottom) {
          el.style.animationPlayState = 'running';
        }
      });
    }
    window.addEventListener('scroll', animateOnScroll);
    window.addEventListener('DOMContentLoaded', () => {
      animateOnScroll();
      // Dynamic year in footer
      document.getElementById('year').textContent = new Date().getFullYear();
      // Contact form submission UX
      const form = document.getElementById('contactForm');
      const successMsg = document.getElementById('formSuccess');
      form.addEventListener('submit', e => {
        e.preventDefault();
        successMsg.style.display = 'block';
        form.reset();
        setTimeout(() => { successMsg.style.display = 'none'; }, 3200);
      });

      // ========== ADMIN PANEL MODAL HANDLERS ==========
      const adminPanelModal = document.getElementById('adminPanelModal');
      const openAdminPanelBtn = document.getElementById('openAdminPanelBtn');
      const closeAdminPanelBtn = document.getElementById('closeAdminPanelBtn');
      openAdminPanelBtn.onclick = () => {
        adminPanelModal.classList.add('active');
        checkLogin();
      };
      closeAdminPanelBtn.onclick = () => {
        adminPanelModal.classList.remove('active');
      };
      adminPanelModal.onclick = (e) => {
        if (e.target === adminPanelModal) adminPanelModal.classList.remove('active');
      };

      // ========== APPWRITE ADMIN PANEL ==========
      // CONFIGURE HERE
      const APPWRITE_ENDPOINT = "https://cloud.appwrite.io/v1"; // or your endpoint
      const APPWRITE_PROJECT = "YOUR_PROJECT_ID"; // <-- Set your Appwrite Project ID
      const POSTS_COLLECTION = "posts";
      const COMMENTS_COLLECTION = "comments";
      const LIKES_COLLECTION = "likes";
      const BUCKET_ID = "media";

      // Appwrite setup
      const client = new Appwrite.Client()
        .setEndpoint(APPWRITE_ENDPOINT)
        .setProject(APPWRITE_PROJECT);
      const account = new Appwrite.Account(client);
      const db = new Appwrite.Databases(client);
      const storage = new Appwrite.Storage(client);

      // UI elements
      const loginSection = document.getElementById('loginSection');
      const loginBtn = document.getElementById('loginBtn');
      const loginEmail = document.getElementById('loginEmail');
      const loginPassword = document.getElementById('loginPassword');
      const loginError = document.getElementById('loginError');
      const adminPanel = document.getElementById('adminPanel');
      const logoutBtn = document.getElementById('logoutBtn');
      const postForm = document.getElementById('postForm');
      const mediaInput = document.getElementById('mediaInput');
      const descInput = document.getElementById('descInput');
      const postSuccess = document.getElementById('postSuccess');
      const postsList = document.getElementById('postsList');

      let currentUser = null;
      let postsCache = [];

      async function checkLogin() {
        try {
          const user = await account.get();
          currentUser = user;
          showPanel();
        } catch (e) {
          showLogin();
        }
      }
      function showLogin() {
        loginSection.style.display = "flex";
        adminPanel.style.display = "none";
      }
      function showPanel() {
        loginSection.style.display = "none";
        adminPanel.style.display = "block";
        loadPosts();
      }
      loginBtn.onclick = async function () {
        loginError.style.display = "none";
        try {
          await account.createEmailSession(loginEmail.value, loginPassword.value);
          checkLogin();
        } catch (e) {
          loginError.textContent = "Login failed. Please check your credentials.";
          loginError.style.display = "block";
        }
      };
      logoutBtn.onclick = async function () {
        await account.deleteSession("current");
        currentUser = null;
        showLogin();
      };

      // ===== POST CREATION =====
      postForm.onsubmit = async function (e) {
        e.preventDefault();
        postSuccess.style.display = "none";
        const file = mediaInput.files[0];
        const desc = descInput.value.trim();
        if (!file || !desc) return;

        try {
          const fileUpload = await storage.createFile(BUCKET_ID, Appwrite.ID.unique(), file);
          const fileId = fileUpload.$id;
          const mime = file.type;
          await db.createDocument(
            "default", POSTS_COLLECTION, Appwrite.ID.unique(),
            {
              media: fileId,
              mediaType: mime.startsWith("video") ? "video" : "image",
              description: desc,
              createdBy: currentUser.email,
              createdAt: new Date().toISOString()
            }
          );
          postSuccess.textContent = "Post published!";
          postSuccess.style.display = "block";
          postForm.reset();
          setTimeout(() => postSuccess.style.display = "none", 1800);
          loadPosts();
        } catch (e) {
          postSuccess.textContent = "Error posting: " + (e.message || "Unknown error");
          postSuccess.style.display = "block";
        }
      };

      // ===== LOAD POSTS =====
      async function loadPosts() {
        postsList.innerHTML = '<div style="text-align:center;color:#888">Loading...</div>';
        try {
          const res = await db.listDocuments("default", POSTS_COLLECTION, [Appwrite.Query.orderDesc("createdAt"), Appwrite.Query.limit(20)]);
          postsCache = res.documents;
          renderPosts();
        } catch (e) {
          postsList.innerHTML = '<div style="text-align:center;color:#c00">Failed to load posts.</div>';
        }
      }

      // ===== RENDER POSTS =====
      async function renderPosts() {
        postsList.innerHTML = "";
        for (const post of postsCache) {
          let mediaUrl = "";
          try {
            mediaUrl = storage.getFilePreview(BUCKET_ID, post.media, 600, 400, "top", undefined, undefined, undefined, undefined).href;
          } catch {}
          let likesCount = 0;
          let liked = false;
          try {
            const likesRes = await db.listDocuments("default", LIKES_COLLECTION, [Appwrite.Query.equal("postId", post.$id)]);
            likesCount = likesRes.documents.length;
            if (currentUser) liked = likesRes.documents.some(l => l.user === currentUser.email);
          } catch {}
          let comments = [];
          try {
            const commRes = await db.listDocuments("default", COMMENTS_COLLECTION, [Appwrite.Query.equal("postId", post.$id), Appwrite.Query.orderAsc("createdAt")]);
            comments = commRes.documents;
          } catch {}
          const card = document.createElement("div");
          card.className = "post-card";
          let mediaHtml = "";
          if (post.mediaType === "video") {
            mediaHtml = `<video class="post-media" src="${mediaUrl}" controls loop preload="metadata"></video>`;
          } else if (post.mediaType === "image") {
            mediaHtml = `<img class="post-media" src="${mediaUrl}" alt="Post media" loading="lazy" />`;
          }
          card.innerHTML = `
            ${mediaHtml}
            <div class="post-desc">${post.description.replace(/</g,"&lt;")}</div>
            <div class="post-actions">
              <button class="like-btn${liked ? " liked":""}" data-id="${post.$id}" title="Like">&#x2764; <span>${likesCount}</span></button>
              <button class="comment-btn" data-id="${post.$id}" title="Comment">&#128172; <span>${comments.length}</span></button>
            </div>
            <div class="comments-section" id="comments-${post.$id}" style="display:none;">
              <div class="comments-list">
                ${comments.map(c => `<div class="comment"><span class="comment-user">${c.user || "Guest"}:</span><span class="comment-content">${c.text.replace(/</g,"&lt;")}</span></div>`).join("")}
              </div>
              <form class="add-comment-form" data-id="${post.$id}">
                <input type="text" placeholder="Add a comment..." maxlength="120" required>
                <button type="submit">Post</button>
              </form>
            </div>
          `;
          postsList.appendChild(card);

          card.querySelector(".like-btn").onclick = async function() {
            if (!currentUser) return alert("Login to like");
            try {
              if (!liked) {
                await db.createDocument("default", LIKES_COLLECTION, Appwrite.ID.unique(), {postId: post.$id, user: currentUser.email});
              } else {
                const likesRes = await db.listDocuments("default", LIKES_COLLECTION, [Appwrite.Query.equal("postId", post.$id), Appwrite.Query.equal("user", currentUser.email)]);
                if (likesRes.documents[0]) {
                  await db.deleteDocument("default", LIKES_COLLECTION, likesRes.documents[0].$id);
                }
              }
              loadPosts();
            } catch {}
          };

          card.querySelector(".comment-btn").onclick = function() {
            const section = card.querySelector(`#comments-${post.$id}`);
            section.style.display = section.style.display === "none" ? "block" : "none";
          };
          card.querySelector(".add-comment-form").onsubmit = async function(ev) {
            ev.preventDefault();
            const input = this.querySelector("input");
            const text = input.value.trim();
            if (!text) return;
            try {
              await db.createDocument("default", COMMENTS_COLLECTION, Appwrite.ID.unique(), {
                postId: post.$id,
                user: currentUser ? currentUser.email : "Guest",
                text,
                createdAt: new Date().toISOString()
              });
              input.value = "";
              loadPosts();
            } catch {}
          };
        }
      }
    });
  </script>
</body>
</html>
